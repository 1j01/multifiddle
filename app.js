// Generated by CoffeeScript 1.6.3
var Pane, ace_editors, fb_project, fb_root, hash, set_theme;

ace_editors = [];

set_theme = function(theme_name) {
  var editor, _i, _len, _results;
  _results = [];
  for (_i = 0, _len = ace_editors.length; _i < _len; _i++) {
    editor = ace_editors[_i];
    _results.push(editor.setTheme("ace/theme/" + theme_name));
  }
  return _results;
};

Pane = (function() {
  function Pane(_arg) {
    var editor, fb_fp, firepad, lang, resize, session,
      _this = this;
    lang = _arg.lang;
    this.$pane = $('<div class="pane">');
    this.$pane.appendTo('body');
    (resize = function() {
      return _this.$pane.css({
        width: innerWidth,
        height: innerHeight
      });
    })();
    $(window).on("resize", resize);
    this.$pad = $('<div>');
    this.$pad.appendTo(this.$pane);
    fb_fp = fb_project.child(lang);
    editor = ace.edit(this.$pad.get(0));
    ace_editors.push(editor);
    session = editor.getSession();
    session.setUseWrapMode(true);
    session.setUseWorker(false);
    session.setMode("ace/mode/" + lang);
    firepad = Firepad.fromACE(fb_fp, editor);
    firepad.on('ready', function() {
      if (firepad.isHistoryEmpty()) {
        return firepad.setText('// JavaScript Editing with Firepad!\nfunction go() {\n	var message = "Hello, world.";\n	console.log(message);\n}');
      }
    });
  }

  return Pane;

})();

fb_root = new Firebase("https://multifiddle.firebaseio.com/");

fb_project = null;

hash = window.location.hash.replace('#', '');

if (hash) {
  fb_project = fb_root.child(hash);
} else {
  fb_project = fb_root.push();
  window.location = window.location + '#' + fb_project.name();
}

$(function() {
  var panes;
  panes = [
    new Pane({
      lang: "javascript"
    })
  ];
  return set_theme("kr");
});
